define(["jquery","template","tools","CKEDITOR","uploadify","validate","form","Jcrop"],function(e,t,i,a){function s(t){e("#btn_upload").uploadify({swf:"/assets/lib/uploadify/uploadify.swf",uploader:"/api/uploader/cover",fileObjName:"cs_cover_original",buttonClass:"btn btn-success btn-sm",onUploadSuccess:function(t,i){e(".preview").html("").append(e("<img />").attr("src",JSON.parse(i).result.path)),e("#btn_selectarea").prop("disabled",!1),o()},itemTemplate:"<span></span>",buttonText:"选择图片",width:"70",height:"auto",formData:{cs_id:t.cs_id},onInit:function(){e("#btn_upload").css({overflow:"hidden"}).find("div").removeClass("uploadify-button")}})}function o(){e(".preview img").Jcrop({aspectRatio:2},function(){var e=this,t=e.ui.stage.width,i=e.ui.stage.width/2,a=(e.ui.stage.height-i)/2;e.newSelection(),e.setSelect([0,a,t,i]),e.initComponent("Thumbnailer",{width:240,height:120,target:".thumb"})})}i.expandMenu(),i.setMenu("/course/add");var n=i.getSearch();e.ajax({url:"/api/course/picture",type:"get",data:{cs_id:n.cs_id},success:function(i){if(i.code){console.log(i.result);var a=t("step2Tpl",i.result);e(".steps").html(a),s(i.result),i.result.cs_cover_original&&o()}}})});